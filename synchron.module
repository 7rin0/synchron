<?php

  use Drupal\Core\Form\FormState;
  use Drupal\Core\Database\Database;
  use Drupal\Core\Database\Connection;
  use Drupal\Component\DependencyInjection\Container;
  use Drupal\synchron\Schema\SynchronService;

  function synchron_form_alter(&$form, FormState $formstate) {

    // Get main synchron services
    $synchronService = \Drupal::service('synchron');

    // TODO: Get this values from admin form
    // Get name off from and to databases
    $fromDatabase = $synchronService->getDefaultConnectionOptions()['database'];
    $toDatabase = $fromDatabase === 'ixarm' ? 'ixarm_achats' : 'ixarm';

    // TODO: Add synchro id field
    $synchronService->provisionFromSiteToAnother(11257, $fromDatabase, $toDatabase);

    die();
  }

  function synchron_entity_base_field_info(EntityTypeInterface $entity_type) {
    // TODO: DO we need to affect every single entity?*
    // Or filter on admin
    $fields = [];
    $fields['synchronid'] = BaseFieldDefinition::create('string')
      ->setLabel('Shared ID by two synchronized entities');
    return $fields;

  }
